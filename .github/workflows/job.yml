name: MySQL Database Creation

on:
  push:
    branches:
      - main

jobs:
  setup-mysql:
    runs-on: ubuntu-latest

    services:
      mysql:
        image: mysql:8.0
        env:
          MYSQL_ROOT_PASSWORD: Moseprek12@
        ports:
          - 3306:3306
        options: --health-cmd="mysqladmin ping --silent" --health-timeout=5s --health-retries=3

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Wait for MySQL to be ready
      run: |
        sleep 30  # Give MySQL time to start

    - name: Create Database
      run: |
        sudo mysql -h 127.0.0.1 -P 3306 -u root -p'Moseprek12@' -e "CREATE DATABASE IF NOT EXISTS employees;"

    - name: Create Table in the Database
      run: |
        sudo mysql -h 127.0.0.1 -P 3306 -u root -p'Moseprek12@' -e "USE employees; CREATE TABLE IF NOT EXISTS employees (
          id INT AUTO_INCREMENT PRIMARY KEY,
          name VARCHAR(100),
          role VARCHAR(50),
          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        );"

    - name: Seed Data into the Database
      run: |
        sudo mysql -h 127.0.0.1 -P 3306 -u root -p'Moseprek12@' -e "USE employees; INSERT INTO employees (name, role) VALUES
        ('Altin', 'DevOps Engineer'),
        ('Enis', 'Developer');"
