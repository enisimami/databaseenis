name: MySQL Database Creation

on:
  push:
    branches:
      - main

jobs:
  setup-mysql:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Install MySQL
      run: |
        sudo apt update
        sudo apt install -y mysql-server

    - name: Start MySQL service
      run: |
        sudo service mysql start

    - name: Set MySQL root password
      run: |
        sudo mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED BY 'Moseprek12@';"

    - name: Create MySQL Database
      run: |
        sudo mysql -u root -p'Moseprek12@' -e "CREATE DATABASE IF NOT EXISTS employees;"

    - name: Create table in the database
      run: |
        sudo mysql -u root -p'Moseprek12@' -e "USE employees; CREATE TABLE IF NOT EXISTS employees (
          id INT AUTO_INCREMENT PRIMARY KEY,
          name VARCHAR(100),
          role VARCHAR(50),
          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        );"

    - name: Seed data into the database
      run: |
        sudo mysql -u root -p'Moseprek12@' -e "USE employees; INSERT INTO employees (name, role) VALUES
        ('Altin', 'DevOps Engineer'),
        ('Enis', 'Developer');"
